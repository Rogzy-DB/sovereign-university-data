---
name: LNbits
description: Платформа для учета торговых операций
---
![presentation](assets/lnbits-intro.webp)

# Система бухгалтерского учета

LNbits содержит множество инструментов для контроля и управления входящими и исходящими средствами, подключения веб-магазина или даже устройств, таких как аппаратный кошелек или банкомат, который вы создали сами. Типы пользователей включают:


- Владельцы кошельков, которые хотят использовать LNbits в качестве интерфейса для управления своими средствами, а также его дополнительные функции.
- Онлайн- и офлайн-торговцы или поставщики услуг, которые хотят принимать платежи в сети Bitcoin onchain и Lightning Network.
- Разработчики, которые хотят создавать приложения Lightning Network.
- Операторы узлов, которые хотят интегрировать свой узел с системой LNbits для целей учета.
- У всех них разные потребности. Мы построили LNbits по модульному принципу, чтобы каждый пользователь мог использовать наши функции так, как ему удобно.

# Менеджер кошелька

LNbits - это бесплатная система учета с открытым исходным кодом, а не менеджер узлов. Управление каналами - это сфера деятельности узла Lightning, который подключен к LNbits в качестве источника финансирования, как LND или c-lightning. Суперпользователь или администратор в системе LNbits отвечает за управление общей доступностью и конфигурацией учетных функций и внутренних расширений.

LNbits выступает в качестве интерфейса между пользователем и узлом Lightning, предоставляя простой и удобный способ управления и взаимодействия с платежной сетью.

Думайте о LNbits как о "модульном фреймворке wordpress" для вашего узла. Простая в управлении платформа, основанная на расширениях, которые вы можете комбинировать для множества вариантов использования.

Думайте о LNbits как о собственном банковском программном обеспечении для управления финансами. Ваша нода предлагает каналы для оплаты, а LNbits расширяет вашу ноду, чтобы вы могли запустить более одного кошелька Lightning, с которым поставляется ваша нода. Эти кошельки не обязательно должны принадлежать вам. Допустим, у вас, как у управляющего узлом LN, уже достаточно ликвидности и средств на канале, и теперь вы хотите предложить некоторые банковские услуги в биткоинах своим друзьям, семье, собственному магазину или другим обычным торговцам.

Вы предложите им простой способ открыть "банковский счет" на вашей ноде, не имея доступа к другим кошелькам на вашей ноде и ко всей ликвидности вашей ноды, а только к своей части. Ваша нода (банк) выступает лишь в качестве транспортного провайдера для их платежей (вход/выход).

ПРИМЕЧАНИЕ: все средства, которые ваши "клиенты" вносят на свои банковские счета LNbits на вашем узле, будут поступать прямо в каналы LN вашего узла. Это означает, что ВЫ являетесь реальным владельцем этих средств. Вы будете нести большую ответственность за их средства. Не будьте злыми и не убегайте с этими средствами, не будьте злыми и не взимайте высокие комиссии. Мы хотим наебать фиатных банкиров, а не наебать друг друга (пользователей биткоина).

# Демо-платформа

Демо-версию можно найти по адресу [https://legend.lnbits.com](https://legend.lnbits.com). Она полностью функциональна и может быть использована для ознакомления с Lightning Network и возможностями LNbits и LNURL в целом. Хотя мы не можем запретить вам использовать его, мы хотели бы попросить вас не использовать его для вашей производственной установки. Мы не только часто работаем над серверами для тестирования новых функций, но и хотели бы поощрять вас запускать свою собственную ноду и LNbits в суверенном режиме. Если вы считаете, что управление узлом - это слишком сложная задача, вы можете подключить LNbits к облачному сервису финансирования хранителей, например Opennode, Luna или Votage, или к Lightning Tipbot в Telegram, и это только некоторые из них.

# Флаер LNbits

Хотите передать основную информацию торговцу или вашему другу-строителю? Мы рады представить вам наш первый флаер для всех желающих. Размер - типичный для всего мира формат флаера с 6 страницами (2 фальца), шириной 3508 и высотой 2480px.

LNbits для торговцев: [EN](/assets/lnbits-merchants-en.pdf) | [DE](/assets/lnbits-merchants-de.pdf) | [ES](/assets/lnbits-merchants-es.pdf) | [IT](/assets/lnbits-merchants-it.pdf) | [PL](/assets/lnbits-merchants-pl.pdf)

LNbits для строителей: [EN](/assets/lnbits-builders-en.pdf) | [DE](/assets/lnbits-builders-de.pdf) | [ES](/assets/lnbits-builders-es.pdf) | [IT](/assets/lnbits-builders-it.pdf) | [PL](/assets/lnbits-builders-pl.pdf)

# Некоторые основы

LNbits работает на основе протокола LNURL, что означает, что запросы принимаются в двух формах: либо как https:// clearnet-ссылка (самоподписанные сертификаты запрещены), либо как http:// v2/v3 onion-ссылка. Чтобы предлагать услуги LNbits, такие как QR-коды LNURLp/w или NFC-карты, которые можно использовать в природе, вам нужно открыть LNbits для clearnet (https).

Перед установкой LNbits убедитесь, что вы прочитали и поняли следующие общие руководства о том, что такое LNbits и какие возможности он открывает перед вами.


- [Руководство LND](https://docs.lightning.engineering/) | Установка LND
- [Пример конфигурации LND](https://github.com/lightningnetwork/lnd/blob/master/sample-lnd.conf) | Настройки LND
- [Руководство CLN](https://docs.corelightning.org/docs/installation) | Установка CLN
- [LUDs](https://github.com/lnurl/luds) LNURL Spec | [NIPs](https://github.com/nostr-protocol/nips) Nostr Spec
- [Управляйте сторожевой башней](https://docs.lightning.engineering/lightning-network-tools/lnd/watchtower) | Очень важно!

Более подробные руководства по использованию LNbits в конкретных сценариях использования здесь:


- [Начало работы с LNbits](https://darthcoin.substack.com/p/getting-started-lnbits) | Руководство по подстатье
- [ToDos для вашей безопасности с LNbits](https://youtu.be/i5FQf96e6zg) | Youtube Video
- [Частные банки в сети Lightning](https://darthcoin.substack.com/p/bitcoin-private-banks-over-lightning) | Руководство по подстатье
- [Запустите кошельки хранителей для ваших друзей и семьи] (https://darthcoin.substack.com/p/the-bank-of-lnbits) | Substack guide
- [LNbits для небольшого ресторана/отеля](https://darthcoin.substack.com/p/lnbits-for-small-merchants) | Substack guide
- [Использование LNbits Streamer copilot](https://darthcoin.substack.com/p/lnbits-streamer-copilot) | Substack guide
- [Начните свой рынок NOSTR с LNbits](https://darthcoin.substack.com/p/lnbits-nostr-market) | Руководство по подстатье
- [Использование LNbits для школьных проектов или фестивальных мероприятий](https://darthcoin.substack.com/p/lnbits-saas-a-solution-for-schools) Руководство по подстатье

# Установите LNbits

## Основное руководство по установке

LNbits может быть установлен на любой машине с ОС Linux. Для этого не требуется мощная машина или сервер, достаточно памяти RAM и немного дискового пространства для базы данных. Его можно запускать отдельно от узла BTC/LN (на локальном ПК или удаленном VPS), на одной машине с узлом или уже установленным на машине с программным обеспечением узла.

Вы можете выбрать один из наиболее распространенных менеджеров пакетов, таких как poetry и nix. По умолчанию LNbits будет использовать SQLite в качестве базы данных. Вы также можете использовать PostgreSQL, что рекомендуется для приложений с высокой нагрузкой. [Здесь приведено руководство по базовой установке с использованием poetry или nix](https://github.com/lnbits/lnbits/blob/main/docs/guide/installation.md).

Для новичков здесь вы найдете более подробные пошаговые руководства по запуску LNbits в конкретных условиях:


- [LNbits on clearnet](https://ereignishorizont.xyz/lnbits-server/en/) by Axel
- [LNbits на VPS](https://github.com/TrezorHannes/vps-lnbits) by Hannes
- [LNbits on cloudflare](https://www.nodeacademy.org/lnbits) by Leo

Вы также можете найти видео по [докеризованной установке на VPS с PostgreSQ, LightningTipBot в качестве источника финансирования с использованием nginx](https://www.massmux.com/howto-complete-lightningtipbot-lnbits-setup-vps/).

[Другие сценарии установки здесь] (https://darthcoin.substack.com/p/build-your-own-lnbits-app-server).

Для узлов с программным обеспечением для связок, пожалуйста, обратитесь к их специальной документации по LNbits: [Citadel](https://runcitadel.space) | [Umbrel](https://umbrel.com) | [MyNode](https://mynodebtc.com) | [RaspiBlitz](https://raspiblitz.org/) | [RaspiBolt](https://raspibolt.org)

## LNbits SaaS

Если вы не разбираетесь в технических вопросах и не хотите самостоятельно размещать источник финансирования и lnbits, есть [LNbits SaaS версия](https://saas.lnbits.com) (Software-as-a-service), которую вы можете использовать. По сути, это как LNbits в облаке, но вы можете сами определять источник финансирования (например, вашу ноду, кошелек LNbits, LNtipbot, fakewallet и т. д.) и переменные окружения - что в основном не характерно для других облачных решений.

[Здесь представлено подробное руководство по использованию LNbits SaaS для конкретных случаев применения] (https://darthcoin.substack.com/p/lnbits-saas-a-solution-for-schools).

## Источники финансирования

LNbits - это не программное обеспечение для управления узлами, а система учета, ориентированная на LN, поверх источника финансирования LND или CLN. После первой установки вы можете посетить свой LNbits по адресу http://localhost:5000/.

Чтобы изменить источник финансирования, перейдите по адресу суперпользователя и выберите источник финансирования в разделе "Manage Server" или отредактируйте файл .env, изменив `LNBITS_BACKEND_WALLET_CLASS` на нужный вам источник, если вы установили `adminUI=TRUE` в `.env`.

Вы найдете файл .env в папке lnbits/ или lnbits/apps/data, расширив команду для перечисления файлов в вашей директории командой `ls -a`.

Вам также может потребоваться установить дополнительные пакеты или выполнить дополнительные шаги по настройке, выбрав нужный источник финансирования. После перезапуска ваша новая настройка будет активна.

Какие источники финансирования можно использовать для LNbits?

LNbits может работать поверх многих источников финансирования лайтнинг-сетей. В настоящее время поддерживаются CoreLightning, LND, LNbits, LNPay, OpenNode, и регулярно добавляются другие.

Важно выбрать источник, который имеет хорошую ликвидность и хорошие связи с пирами. Если вы используете LNbits для публичных услуг, то платежи ваших пользователей будут проходить счастливо в обоих направлениях.

Бэкэнд-кошелек (источник финансирования) может быть настроен с помощью следующих переменных окружения LNbits в файле `.env` или в вашей учетной записи суперпользователя в разделе Manage-Server.

Если вы хотите использовать версию .env, параметры можно найти здесь:

### CoreLightning


- CLN
  - кЛАСС `LNBITS_BACKEND_WALLET_CLASS`: **CoreLightningWallet**
  - `CORELIGHTNING_RPC`: /file/path/lightning-rpc
- Искра (c-lightning)
  - кЛАСС `LNBITS_BACKEND_WALLET_CLASS`: **SparkWallet**
  - `SPARK_URL`: http://10.147.17.230:9737/rpc
   - `SPARK_TOKEN`: secret_access_key

### Демон сети Lightning


- LND (REST)
  - кЛАСС `LNBITS_BACKEND_WALLET_CLASS`: **LndRestWallet**
  - `LND_REST_ENDPOINT`: http://10.147.17.230:8080/
  - `LND_REST_CERT`: /file/path/tls.cert
  - `LND_REST_MACAROON`: /file/path/admin.macaroon или Bech64/Hex
  - `LND_REST_MACAROON_ENCRYPTED`: eNcRyPtEdMaCaRoOn
- LND (gRPC)
  - `LNBITS_BACKEND_WALLET_CLASS`: **LndWallet**
  - `LND_GRPC_ENDPOINT`: ip_address
  - `LND_GRPC_PORT`: порт
  - `LND_GRPC_CERT`: /file/path/tls.cert
  - `LND_GRPC_MACAROON`: /file/path/admin.macaroon или Bech64/Hex

Вместо этого вы можете использовать макару с AES-шифрованием (подробнее), используя


  - `LND_GRPC_MACAROON_ENCRYPTED`: eNcRyPtEdMaCaRoOn

Чтобы зашифровать свой macaroon, запустите `./venv/bin/python lnbits/wallets/macaroon/macaroon.py`.

### LNbits (другой экземпляр LNbits)


- Экземпляр LNbits, размещенный на облачном сервере или на вашем собственном домашнем сервере
  - кЛАСС `LNBITS_BACKEND_WALLET_CLASS`: **LNbitsWallet**
  - `LNBITS_ENDPOINT`: https://lnbits.mydomain.com
  - `LNBITS_KEY`: my-lnbits-AdminKey
- LNbits Legend Demo Server (!! Не используйте его в производственных/коммерческих целях, только для тестирования !!!)
  - кЛАСС `LNBITS_BACKEND_WALLET_CLASS`: **LNbitsWallet**
  - `LNBITS_ENDPOINT`: https://legend.lnbits.com
  - `LNBITS_KEY`: legend-lnbits-AdminKey

### Молния TipBot

Чтобы подключить ваш [Lightning Tipbot](https://t.me/LightningTipBot) из Telegram, вам нужно установить следующий параметр:


  - кЛАСС `LNBITS_BACKEND_WALLET_CLASS`: **LnTipsWallet**
  - `LNBITS_ENDPOINT`: https://ln.tips
  - `LNBITS_KEY`: Чтобы получить ключ, вам нужно будет один раз выполнить команду /api в приватном чате с LightningTipbot в Telegram.

Также смотрите это руководство по установке [LNbits с LightningTipBot через vps](https://www.massmux.com/howto-complete-lightningtipbot-lnbits-setup-vps/)

### IBEX HUB

Зарегистрируйтесь [здесь] (https://ibexpay.ibexmercado.com/onboard), затем получите ключи/токены оттуда, конечная точка - https://ibexpay-api.ibexmercado.com.

Более подробную информацию можно найти в [IBEX API-Documentation](https://ibexpay-api.readme.io/reference/getting-started-with-your-api).

### LNPay

Чтобы слушатель счетов работал, у вас есть общедоступный URL в LNbits и вы должны настроить [LNPay webhook](https://dashboard.lnpay.co/webhook/), указывающий на `<ваш хост LNbits>/wallet/webhook` с событием "Wallet Receive" и без указания секрета. Настройка `https://mylnbits/wallet/webhook` будет конечным адресом, который будет получать уведомления о любом платеже.


  - кЛАСС `LNBITS_BACKEND_WALLET_CLASS`: **LNPayWallet**
  - `LNPAY_API_ENDPOINT`: https://api.lnpay.co/v1/
  - `LNPAY_API_KEY`: sak_apiKey
  - `LNPAY_WALLET_KEY`: waka_apiKey

### OpenNode

Чтобы счет-фактура работал, в вашем LNbits должен быть общедоступный URL. Настройка вебхука необязательна.


  - кЛАСС `LNBITS_BACKEND_WALLET_CLASS`: **OpenNodeWallet**
  - `OPENNODE_API_ENDPOINT`: https://api.opennode.com/
  - `OPENNODE_KEY`: opennodeAdminApiKey

### Элби

Alby - это расширение для браузера с функциями LN-кошелька и счета LNDHUB, который можно использовать в качестве источника финансирования для LNbits. [Подробнее здесь] (https://getalby.com/).

Чтобы счет-фактура работал, у вас должен быть общедоступный URL в LNbits. Настраивать веб-хук вручную не нужно. Вы можете сгенерировать токен доступа Alby здесь: https://getalby.com/developer/access_tokens/new


- `LNBITS_BACKEND_WALLET_CLASS`: AlbyWallet
- `ALBY_API_ENDPOINT`: https://api.getalby.com/
- `ALBY_ACCESS_TOKEN`: AlbyAccessToken

## Дополнительные руководства / Руководства по устранению неполадок

Вот несколько дополнительных инструкций на случай, если они вам понадобятся. Нажмите на стрелку, чтобы развернуть описание.

### The Killswitch 🚨

В последнее время не только во всем мире, но и в LNbits появилось так много опасных ошибок, что мы решили что-то с этим сделать. Теперь вы можете подписаться на предупреждения и/или принять непосредственные меры, если уязвимость или ошибка, которая может привести к потере средств, снова возникнет.

![killswitchn](assets/lnbits-killswitch.webp)

При переключении на void-кошелек все типы пользователей на инстансе увидят желтый баннер там, где обычно находится уведомление "LNbits is in Beta" рядом с областью тем/языков справа - и это самый очевидный намек на то, что что-то произошло. Взгляните на новую вкладку сервера, выделенную зеленым цветом в левой части окна.

Как это работает? Когда killswitch включен, секретный репозиторий github, доступный только основной команде LNbits, будет проверяться с интервалом в X минут (который можно указать). Если в этом репозитории будет опубликована уязвимая ошибка, это послужит сигналом, который запустит killswitch на всех установках, подписавшихся на него, и переведет ваш экземпляр lnbits на использование пустого кошелька. Если облака рассеялись, и вы установили обновление безопасности, вы можете установить источник финансирования на вашу ноду, кошелек или то, что вы используете, также через раздел Manage Server. В этой вики есть раздел о переключении источников финансирования, если вы не знаете, что настраивать.

### Разница между администратором и суперпользователем

LNbits Admin UI позволяет изменять настройки LNbits через фронтенд LNbits. По умолчанию он отключен, и при первой установке переменной окружения `LNBITS_ADMIN_UI=true` в файле `.env` настройки инициализируются и будут использоваться. В дальнейшем будут использоваться соответствующие настройки из базы данных, а не из файла .env.

### Суперпользователь

В пользовательском интерфейсе администратора мы ввели суперпользователя, который имеет доступ к серверу и может изменять настройки, которые могут привести к падению сервера или его невосприимчивости через фронтенд и api, например, изменять источник финансирования. Суперпользователь хранится только в таблице настроек базы данных. После "сброса настроек по умолчанию" и перезапуска создается новый суперпользователь. Мы также добавили декоратор для маршрутов API, чтобы проверить существование суперпользователя. Его ID никогда не передается через api и фронтенд, а только получает значение bool (да/нет), если вы являетесь суперпользователем или нет.

Только суперпользователь имеет право выводить сатоши на разные кошельки через раздел "Пополнить счет".

Вы также можете передать суперпользователя через webhook другому сервису, когда он будет создан. Больше информации здесь https://github.com/lnbits/lnbits/blob/main/lnbits/settings.py `класс SaaSSettings`

Во фронтенде вы также найдете возможность изменить изображение магазина, которое отображается на странице "создать кошелек", открыв раздел "Управление сервером" и выбрав "Тема -> Пользовательский логотип".

### Пользователи-администраторы

Переменная окружения: `LNBITS_ADMIN_USERS`, список идентификаторов пользователей через запятую. Пользователи Admin могут изменять настройки в админке - за исключением настроек источника финансирования, так как это потребует перезагрузки сервера и может сделать сервер недоступным. Также они имеют доступ ко всем расширениям, выделенным для них в `LNBITS_ADMIN_EXTENSIONS`.

### Разрешенные пользователи

Переменная окружения: `LNBITS_ALLOWED_USERS`, список идентификаторов пользователей через запятую. Определив этих пользователей, LNbits больше не будет доступен для публики. Только определенные пользователи и администраторы смогут получить доступ к фронтенду LNbits.

#### Обновление LNbits

Обычное обновление локального экземпляра LNbits осуществляется простым копированием-вставкой следующих команд CLI:

```
cd lnbits
## Stop LNbits with `ctrl + x`
git pull
## Keep your poetry install up to date, this can be done with
poetry self update
poetry install --only main
## or
git checkout main && git pull && poetry install
## Start LNbits with
poetry run lnbits
```

Если вы используете Raspiblitz или MyNode, вам может дополнительно понадобиться

```
sudo systemctl restart lnbits
```

в конце, потому что он запускает LNbits как сервис.

На Umbrel/Citadel команды будут следующими

```
cd ~/apps/lnbits
git pull upstream main
sudo ~/scripts/app start lnbits
```

#### Миграция с SQLite на PostgreSQL

Если у вас уже установлен и работает LNbits на базе данных SQLite, мы настоятельно рекомендуем перейти на postgres, если вы планируете использовать LNbits в масштабе.

В комплект входит скрипт, который легко выполнит миграцию. У вас должен быть уже установлен Postgres и должен быть пароль для пользователя (см. руководство по установке Postgres выше). Кроме того, ваш экземпляр LNbits должен один раз запуститься на Postgres, чтобы реализовать схему базы данных, прежде чем миграция сработает:

```
# STOP LNbits
# add the database connection string to .env 'nano .env' LNBITS_DATABASE_URL=
# postgres://<user>:<password>@<host>/<database> - alter line bellow with your user, password and db name
LNBITS_DATABASE_URL="postgres://postgres:postgres@localhost/lnbits"
# save and exit
# START LNbits
# STOP LNbits
poetry run python tools/conv.py
# or
make migration
```

Надеюсь, теперь все работает и мигрирует... Снова запустите LNbits и проверьте, все ли работает правильно.

#### Резервное копирование и восстановление базы данных

Обратитесь к [этому очень подробному руководству по процессу резервного копирования и восстановления] (https://ereignishorizont.xyz/lnbits-server/en/#94_LNbits_-_Databases_Backup_Restore).

#### Пополнение кошелька LNbits с моего узла не работает

Если вы хотите отправлять саты с того же узла, который является источником финансирования ваших LNbits, вам нужно будет отредактировать файл lnd.conf.

Параметры, которые необходимо включить, следующие: `allow-circular-route=1`

Пожалуйста, сделайте это в разделе Application options вашего lnd.conf. В противном случае запуск LND на каком-либо узле связки может завершиться неудачей.

ПРИМЕЧАНИЕ: Для пополнения счета LNbits рекомендуется использовать новое расширение adminUI с опцией "Пополнить счет".

#### Ошибка 426

Я получил ошибку: "lnurl должен быть доставлен через публично доступный домен https или tor. требуется 426 обновление"</summary>

Эта ошибка обычно возникает из-за того, что ваш LNbits, находящийся в туннеле ngnix, неправильно передает адрес LNURL. Остановите LNbits и отредактируйте файл .env, добавив эту строку:

`FORWARDED_ALLOW_IPS=*`

Также если вы используете установку ngnix, убедитесь, что в конфигурации ngnix есть эти заголовки:

```
RequestHeader set "X-Forwarded-Proto" expr=%{REQUEST_SCHEME}
RequestHeader set "X-Forwarded-SSL" expr=%{HTTPS}
```

#### Ошибка сети

При сканировании QR я получаю "ошибку https", "сетевую ошибку" или другие</summary

Плохие новости, это ошибка маршрутизации, которая может иметь множество причин. Сначала проверьте LNURL QR с помощью [Lightning Decoder](https://lightningdecoder.com/), если вы найдете там что-то странное. Давайте попробуем рассмотреть несколько наиболее возможных проблем и их решений.

LNbits работает только через Tor, вы не можете открыть его на публичном домене, например lnbits.yourdomain.com


- Учитывая, что вы хотите, чтобы ваша настройка оставалась такой, откройте кошелек LNbits, используя .onion URI, и создайте его снова. Таким образом, QR будет доступен только через этот .onion URI, то есть через tor. Не генерируйте этот QR из .local URI, потому что он не будет доступен через интернет - только из домашней локальной сети.
- Откройте приложение LN-кошелька, которое вы использовали для сканирования QR, на этот раз с помощью tor (см. настройки приложения кошелька). Если приложение не предлагает tor, вы можете использовать Orbot (Android). Подробные инструкции о том, как открыть LNbits для clearnet/https, см. в разделе "Установка".

#### Запретить другим генерировать кошельки на моих LNbits

Когда вы запускаете LNbits в clearnet, практически каждый может сгенерировать на нем кошелек. Поскольку средства вашей ноды привязаны к этим кошелькам, вы можете захотеть предотвратить это. Есть два способа сделать это:

Настройте разрешенных пользователей и расширения в файле `.env` ([см. пример env здесь](https://github.com/lnbits/lnbits/blob/main/.env.example)). Это работает, только если вы используете параметр `adminUI=FALSE` в .env, в противном случае вам нужно сделать это в разделе Manage Server -> Users -> Allowed Users. Все остальные после этого не будут допущены.

#### Настройте срок действия счета-фактуры

Теперь вы можете генерировать счета-фактуры с заданным сроком действия. Совместим с бэкендами: LndRestWallet, LndWallet, CoreLightningWallet, EclairWallet, LnbitsWallet, SparkWallet, пока что!

Вы можете установить `LIGHTNING_INVOICE_EXPIRY` в вашем .env-файле или использовать AdminUI, чтобы изменить значение по умолчанию для всех счетов. Также появилось новое поле в конечной точке /api/v1/payments, где вы можете задать срок действия в JSON-данных.

## Wallet-URL удален

### Кошелек на демо-сервере legend.lnbits

Всегда сохраняйте копию wallet-URL, Export2phone-QR или LNDhub для своих собственных кошельков в безопасном месте. LNbits НЕ МОЖЕТ помочь вам восстановить их в случае потери.

### Кошелек на собственном источнике/узле финансирования

Всегда сохраняйте копию wallet-URL, Export2phone-QR или LNDhub для своих собственных кошельков в безопасном месте. Вы можете найти всех пользователей LNbits и идентификаторы кошельков в вашем расширении LNbits user manager или в вашей базе данных sqlite. Чтобы отредактировать или прочитать базу данных LNbits, перейдите в папку LNbits /data и найдите файл sqlite.db. Вы можете открыть и отредактировать его с помощью excel или специального SQL-редактора, например [SQLite browser](https://sqlitebrowser.org/).

Также вы можете сбрасывать кошельки через cli и просматривать каждый кошелек в вашей базе данных.

```
cd ~/app-data/lnbits/data
sqlite3 database.sqlite3
.dump wallets
```

Вывод будет выглядеть следующим образом

```
INSERT INTO wallets VALUES('f8a43fc363ea428db5c53b3559935f1f','NAME OF WALLET','1280ff5910a9c485a782a2376f338b6c','33b95b099ce848e3b484124373f681e5','2cca208ae6d94d438227b9487ff216f9');
```

и вы хотите поместить эти значения в url следующим образом

```
https://your.lnbits.com/wallet?usr=1280ff5910a9c485a782a2376f338b6c&wal=f8a43fc363ea428db5c53b3559935f1f
```

Замените f8a43fc363ea428db5c53b3559935f1f на значение, стоящее перед именем (в нашем примере f8a43fc363ea428db5c53b3559935f1f), а 1280ff5910a9c485a782a2376f338b6c - это ваш пользователь, который должен стать значением, указанным после имени. Чтобы выйти из sqlite3, введите

```
.quit
```

#### LNURL для адреса молнии наоборот

Попробуйте этот [encoder](https://lnurl-codec.netlify.app/) от fiatjaf или [this one](https://lightningdecoder.com/). Для оплаты или проверки LNURLp вы также можете использовать [LNurlpay](https://wwww.lnurlpay.com/). Там должно быть указано HTTPS, а не HTTP.

#### Настройте комментарий, который люди видят при оплате моего LNURLp QR

Когда вы создаете LNURL-p, по умолчанию поле для комментариев не заполняется. Это означает, что комментарии не могут быть прикреплены к платежам.

Чтобы разрешить комментарии, добавьте длину поля для комментариев, от 1 до 250 символов. Как только вы поставите там число, поле для комментариев будет отображаться в процессе оплаты. Вы также можете отредактировать уже созданный LNURL-p и добавить это число.

![lnbits comments](assets/lnbits-comments.webp)

#### Депозит onchain BTC на LNbits

Существует два способа обмена сатов с onchain BTC на LN BTC (или на LNbits).

##### Через внешнюю службу подмены.

Другие пользователи, не имеющие доступа к вашему экземпляру LNb, могут воспользоваться сервисом обмена, например [Boltz](https://boltz.exchange/), [FixedFloat](https://fixedfloat.com/), [DiamondHands](https://swap.diamondhands.technology/) или [ZigZag](https://zigzag.io/). Это полезно, если вы предоставляете только LNURL/LN-счета от вашего экземпляра LNbits, но у плательщика есть только onchain-саты, поэтому ему придется сначала обменять эти саты на своей стороне. Процедура проста: пользователь отправляет onchain btc на своп-сервис и предоставляет LNURL/LN-инвойс от LNbits в качестве пункта назначения свопа.

##### Использование расширения Onchain и Boltz LNbits.

Помните, что это отдельный кошелек, а не кошелек LN btc, который представлен LNbits как "ваш кошелек" в источнике финансирования LN. Этот ончейн-кошелек можно также использовать для обмена LN btc на (например, ваш аппаратный кошелек) с помощью расширения LNbits Boltz или Deezy. Если у вас есть интернет-магазин, который связан с вашим LNbits для платежей LN, очень удобно регулярно сливать все саты из LN в onchain. Это приведет к увеличению пространства в ваших каналах LN, чтобы иметь возможность получать новые свежие саты.

Процедура для тех, у кого нет аппаратного кошелька биткоина:


- Используйте кошелек Electrum или Sparrow для создания нового кошелька onchain и сохраните резервную копию в безопасном месте.
- Перейдите в раздел "Информация о кошельке" и скопируйте xpub.
- Перейдите в раздел LNbits - Onchain extension и создайте новый кошелек только для часов с этим xpub.
- Перейдите в раздел LNbits - расширение Tipjar и создайте новый Tipjar. Выберите также опцию onchain помимо кошелька LN.
- Дополнительно - перейдите в расширение LNbits - SatsPay и создайте новый счет для onchain btc. Вы можете выбрать между onchain и LN или обоими. Затем будет создан счет-фактура, которым можно поделиться.
- Дополнительно - Если вы используете LNbits, привязанный к странице Wordpress + Woocommerce, то после создания/привязки кошелька только для часов к кошельку магазина LN btc у покупателя будут оба варианта оплаты на одном экране.

Когда вы получаете платеж в LNbits, в журнале транзакций будет отображаться только возобновленный тип транзакции.

![lnbits payment details](assets/lnbits-payment-details.webp)

В обзоре транзакций вы увидите маленькую зеленую стрелку, обозначающую полученные средства, и красную стрелку, обозначающую отправленные средства.

Если вы нажмете на эти стрелки, во всплывающем окне подробностей будут показаны прикрепленные сообщения, а также имя отправителя, если оно указано.

Чтобы настроить имя для отображения в платежах, в LNbits это в настоящее время невозможно сделать - только получить. Это возможно только в том случае, если LN-кошелек отправителя поддерживает [LUD-18](https://github.com/lnurl/luds/blob/luds/18.md) (nameDesc), например [OBW, Blixt, Alby, ZBD, BitBanana](https://github.com/lnurl/luds?tab=readme-ov-file#lnurl-documents).

После этого вы увидите псевдоним/псевдонимы в разделе деталей ваших транзакций LNbits (нажмите на стрелки). Обратите внимание, что вы можете указать там любое имя, и оно может не совпадать с настоящим именем отправителя, если вы его получите.

![lnbits namedesc](assets/lnbits-namedesc.webp)

Чтобы импортировать счет LNbits в приложение-кошелек, откройте LNbits с тем счетом/кошельком, который вы хотите использовать, перейдите в раздел "Управление расширениями" и активируйте расширение LNDHUB. Откройте расширение LNDHUB, выберите кошелек, который вы хотите использовать, и отсканируйте QR "admin" или "invoice only", в зависимости от уровня безопасности, который вы хотите для этого кошелька.

Вы можете использовать [Zeus](https://zeusln.app/) или [Bluewallet](https://bluewallet.io/) в качестве приложений-кошельков для аккаунта lndhub, при этом BW поддерживает более одного такого кошелька.

При этом мы рекомендуем также установить сетевой URI LN на свой собственный узел. Если ваш экземпляр LNbits работает только через Tor, вы также должны использовать эти приложения с активированным Tor. Также в этом случае вам нужно открывать страницу LNbits через ваш адрес Tor .onion.

Если у вас возникает ошибка "неподдерживаемый тип хэша" при использовании ypub в расширении On-chain, проверьте, не использует ли ваш экземпляр LNbits python 3.10, возможно, на него влияет [эта проблема](https://stackoverflow.com/questions/72409563/unsupported-hash-type-ripemd160-with-hashlib-in-python). Отредактируйте openssl.cnf, как описано в ответе stackoverflow, и перезапустите LNbits.

## Инструментарий и строительство с помощью LNbits

У LNbits есть всевозможные [открытые API](https://legend.lnbits.com/docs) и инструменты для программирования и подключения к множеству различных устройств для гигантского количества случаев использования.

Если вы новичок в конструировании, начните с этого [MakerBits presentations](https://www.youtube.com/channel/UCZhKfzK6_KWZ-CFC2wXQVBw/videos) от Бена Арка о создании гаджетов на основе LNbits.

### ВАЖНО:


- LNbits работает на основе протокола LNURL, запросы к которому принимаются в двух формах: либо как https:// clearnet link (самоподписанные сертификаты запрещены), либо как http:// v2/v3 onion link. Чтобы предлагать услуги LNbits, такие как QR-коды LNURLp/w или NFC-карты, которые можно использовать в природе, вам нужно открыть LNbits для clearnet (https).
- Для питания esp32 используйте только DATA-кабели. Не все кабели поддерживают передачу данных в дополнение к питанию esp. Вы будете не первым, если кабель, поставляемый с esp, будет только для питания
- Не используйте USB-концентратор с подключенными к нему другими устройствами. Это может привести к странным эффектам, которые трудно отладить (например, не запускается или не останавливается).
- Для реализации проектов esp под MacOS вам понадобится драйвер моста UART. Если у вас возникли проблемы с драйвером на Mac или Linux, вы можете найти их здесь или, если задействован TTGO Display, здесь. Если вы работаете на windows и у вас возникли проблемы с подключением, обязательно загрузите старую версию 11.1.0, потому что новая версия не работает! Здесь вы также можете найти последовательный терминал для проверки соединения - установите скорость передачи 115200.
- Хотя использовать Platform.io гораздо удобнее (например, зависимости устанавливаются автоматически), мы рекомендуем использовать Arduino всем, кто только начинает строить.
- TT-Go Display S3: Цвет вкладки защитной пленки говорит о том, какой именно контроллер (ST7735_redtab, ST7735_blacktag, ST7735_greetab, greentab128, ...) был использован для ее создания. Сохраните его, чтобы иметь возможность отладки, если вы запрограммируете себя и экран не будет отображать графику корректно, например, цвета будут неправильными, зеркальные изображения или блуждающие пиксели по краям. Если вам когда-нибудь понадобится это сделать, есть эпическое руководство по настройке под разные дисплеи
- Всегда используйте строчные буквы lnurl239xx вместо LNURLl239xx
- Добавление lightning:lnurl1234xyz создаст QR, который попросит открыть кошелек пользователя для этого счета при сканировании (последнее установленное приложение Lightning на iOS, настройка в Android)
- Если вы прошиваете esp32 через веб, то он будет работать только с этими браузерами (TL:DR Chrome, Edge и Opera).
- Обратите внимание на эту ссылку PIN-OUT для esp
- Когда вы используете FOSSoftware или FOSGuides, пожалуйста, всегда указывайте автора. Всем нравится наблюдать за тем, как растет их ребенок, и это также запускает цепочку создания, за которой очень приятно наблюдать :)

Заходите в [Makerbits Telegram Group](https://t.me/makerbits), если вам нужна помощь с проектом - мы поможем!

![lnbits hackathlon](assets/lnbits-hackathlon.webp)

Вот некоторые категории проектов, которые вы можете создать с помощью LNbits:


- [Nostr Signing Device](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#nostr-signing-device)
- [Archade Machine](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#arcade-machine)
- [Gerty](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#gerty)
- [Nostr Zap Lamp](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#zap-lamp)
- [BTC/LN ATM](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#atm)
- [LNPoS](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#lnpos-terminal)
- [Поросенок-молния](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#lightning-piggy)
- [Аппаратный кошелек](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#hardware-wallet)
- [Bitcoin Switch](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#bitcoin-switch)
- [Торговый автомат](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#vending-machine)
- [Bolty](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#bolty)
- [Nerdminer](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#Nerdminer)
- [Bitcoin Ticker](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#bitcoin-ticker)
- [BTClock](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#btclock)
- [Лора и ячеистая сеть](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#lora)
- [ПОМОЩНИКИ И РЕСУРСЫ](https://github.com/lnbits/lnbits/wiki/Tooling-&-Building-with-LNbits#resources)
- [Больше примеров проектов "Powered by LNbits" здесь] (https://github.com/lnbits/lnbits/wiki/Powered-by-LNbits).
- [Варианты использования LNbits](https://github.com/lnbits/lnbits/wiki/Use-Cases-of-LNbits)